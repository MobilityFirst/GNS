******************************
Running a local test with GNS using DBClient.
******************************

DBClient is an alternate interface to use GNS, which we expect to be used only for testing purposes. This interface provides a minimal set of commands, in fact exactly four commands of read, write, add, and remove for a given name. 
By following these instructions you can run a sample program which uses the DBClient interface. The test code which the client runs runs is in the class edu.umass.cs.gns.test.nioclient.ClientSample. You can write your own test based on the code in this class.


NOTE:  Assuming you have built GNS.jar (Step 1 below), the subsequent steps  can be automatically run by running the script ‘run_basic.sh’ in this folder as follows:

./run_basic.sh <Complete-path-to-GNS.jar>

To run an unreplicated GNS (1 name server), use the following command:

./run_basic_1node.sh <Complete-path-to-GNS.jar>



******************************
STEP BY STEP INSTRUCTIONS:
******************************

(1) Check out GNS from svn locally. Lets call the checkout folder GNS_FOLDER. Then, build jar file for GNS as follows:

svn co svn+ssh://none.cs.umass.edu/svn/mobility-first/GNS/trunk GNS_FOLDER
cd GNS_FOLDER
ant all

(2) Download and run mongoDB on local machine as follows. 

# create directory where GNS data will be stored. Lets call that folder GNS_DATA
mkdir -p GNS_DATA
# run mongodb
mongod --dbpath=GNS_DATA

# to delete any state from from previous run of GNS. use following commands:
killall -9 mongod
rm -rf GNS_DATA


(3) Now let us create a config file describing IP and ports for 3 name servers and 1 local name servers like this. Let us call this file NODE_CONFIG. A sample file is included in this folder by name: node_config

0 yes local 23410 0 0 0
1 yes local 23510 0 0 0
2 yes local 23610 0 0 0
3 no local 23710 0 0 0

The format of each line is as follows: 
node_id    isNS?    hostname   starting_port ping_latency latitude longitude

‘isNS?' should be ‘yes' for  name servers, ’no’ for local name servers. The last three values are not really used and they can be zero. Note that starting port numbers are different for each node.

(4) Now we will run name servers. For each name server, create a separate new directory and type the following command in side that directory. Specify complete path to NODE_CONFIG file when typing following commands.

Run name server with id = 0:
java -ea -cp GNS_FOLDER/dist/GNS.jar edu.umass.cs.gns.main.StartNameServer -id 0 -nsfile NODE_CONFIG

Run name server with id = 1:
java -ea -cp GNS_FOLDER/dist/GNS.jar edu.umass.cs.gns.main.StartNameServer -id 1 -nsfile NODE_CONFIG

Run name server with id = 2:
java -ea -cp GNS_FOLDER/dist/GNS.jar edu.umass.cs.gns.main.StartNameServer -id 2 -nsfile NODE_CONFIG


(5) Next, we will start a local name server.  To run local name server, again create a separate directory, and type the following command.

java -ea -cp GNS_FOLDER/dist/GNS.jar edu.umass.cs.gns.main.StartLocalNameServer -id 3 -nsfile NODE_CONFIG -experimentMode -statFileLoggingLevel FINE -statConsoleOutputLevel FINE


(6) Finally run the client using following command:

java -ea -cp GNS_FOLDER/dist/GNS.jar  edu.umass.cs.gns.test.nioclient.SampleClient GNS_FOLDER/dist/GNS.jar CLIENT_PORT

The client will terminate by printing the following message:

Client received all responses ... SUCCESS.

The name servers and local name servers will continue to run and you need to kill them manually.


