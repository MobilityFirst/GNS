//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ../src/edu/umass/cs/gnsclient/client/CommandUtils.java
//

#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "edu/umass/cs/gnsclient/client/CommandUtils.h"
#include "edu/umass/cs/gnscommon/GNSProtocol.h"
#include "edu/umass/cs/gnscommon/ResponseCode.h"
#include "edu/umass/cs/gnscommon/exceptions/client/AclException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/ClientException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/DuplicateNameException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/EncryptionException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/FieldNotFoundException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/InvalidFieldException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/InvalidGuidException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/OperationNotSupportedException.h"
#include "edu/umass/cs/gnscommon/exceptions/client/VerificationException.h"
#include "edu/umass/cs/gnscommon/packets/CommandPacket.h"
#include "edu/umass/cs/gnscommon/packets/ResponsePacket.h"
#include "edu/umass/cs/gnscommon/utils/CanonicalJSON.h"
#include "edu/umass/cs/nio/JSONPacket.h"
#include "java/lang/StringBuilder.h"
#include "org/json/JSONArray.h"
#include "org/json/JSONException.h"
#include "org/json/JSONObject.h"

@implementation EduUmassCsGnsclientClientCommandUtils

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  EduUmassCsGnsclientClientCommandUtils_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (NSString *)specialCaseSingleFieldWithNSString:(NSString *)response {
  return EduUmassCsGnsclientClientCommandUtils_specialCaseSingleFieldWithNSString_(response);
}

+ (OrgJsonJSONArray *)commandResponseToJSONArrayWithNSString:(NSString *)field
                                                withNSString:(NSString *)response {
  return EduUmassCsGnsclientClientCommandUtils_commandResponseToJSONArrayWithNSString_withNSString_(field, response);
}

+ (void)addMessageWithoutSignatureToJSONWithOrgJsonJSONObject:(OrgJsonJSONObject *)command {
  EduUmassCsGnsclientClientCommandUtils_addMessageWithoutSignatureToJSONWithOrgJsonJSONObject_(command);
}

+ (EduUmassCsGnscommonPacketsResponsePacket *)checkResponseOldSchoolWithEduUmassCsGnscommonPacketsResponsePacket:(EduUmassCsGnscommonPacketsResponsePacket *)cvrp {
  return EduUmassCsGnsclientClientCommandUtils_checkResponseOldSchoolWithEduUmassCsGnscommonPacketsResponsePacket_(cvrp);
}

+ (NSString *)checkResponseOldSchoolWithNSString:(NSString *)response {
  return EduUmassCsGnsclientClientCommandUtils_checkResponseOldSchoolWithNSString_(response);
}

+ (EduUmassCsGnscommonPacketsResponsePacket *)checkResponseWithEduUmassCsGnscommonPacketsResponsePacket:(EduUmassCsGnscommonPacketsResponsePacket *)responsePacket
                                                            withEduUmassCsGnscommonPacketsCommandPacket:(EduUmassCsGnscommonPacketsCommandPacket *)command {
  return EduUmassCsGnsclientClientCommandUtils_checkResponseWithEduUmassCsGnscommonPacketsResponsePacket_withEduUmassCsGnscommonPacketsCommandPacket_(responsePacket, command);
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x9, 0, 1, -1, -1, -1, -1 },
    { NULL, "LOrgJsonJSONArray;", 0x9, 2, 3, 4, -1, -1, -1 },
    { NULL, "V", 0x9, 5, 6, 4, -1, -1, -1 },
    { NULL, "LEduUmassCsGnscommonPacketsResponsePacket;", 0xc, 7, 8, 9, -1, -1, -1 },
    { NULL, "LNSString;", 0x9, 7, 1, 9, -1, -1, -1 },
    { NULL, "LEduUmassCsGnscommonPacketsResponsePacket;", 0x9, 10, 11, 9, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(init);
  methods[1].selector = @selector(specialCaseSingleFieldWithNSString:);
  methods[2].selector = @selector(commandResponseToJSONArrayWithNSString:withNSString:);
  methods[3].selector = @selector(addMessageWithoutSignatureToJSONWithOrgJsonJSONObject:);
  methods[4].selector = @selector(checkResponseOldSchoolWithEduUmassCsGnscommonPacketsResponsePacket:);
  methods[5].selector = @selector(checkResponseOldSchoolWithNSString:);
  methods[6].selector = @selector(checkResponseWithEduUmassCsGnscommonPacketsResponsePacket:withEduUmassCsGnscommonPacketsCommandPacket:);
  #pragma clang diagnostic pop
  static const void *ptrTable[] = { "specialCaseSingleField", "LNSString;", "commandResponseToJSONArray", "LNSString;LNSString;", "LOrgJsonJSONException;", "addMessageWithoutSignatureToJSON", "LOrgJsonJSONObject;", "checkResponseOldSchool", "LEduUmassCsGnscommonPacketsResponsePacket;", "LEduUmassCsGnscommonExceptionsClientClientException;", "checkResponse", "LEduUmassCsGnscommonPacketsResponsePacket;LEduUmassCsGnscommonPacketsCommandPacket;" };
  static const J2ObjcClassInfo _EduUmassCsGnsclientClientCommandUtils = { "CommandUtils", "edu.umass.cs.gnsclient.client", ptrTable, methods, NULL, 7, 0x1, 7, 0, -1, -1, -1, -1, -1 };
  return &_EduUmassCsGnsclientClientCommandUtils;
}

@end

void EduUmassCsGnsclientClientCommandUtils_init(EduUmassCsGnsclientClientCommandUtils *self) {
  NSObject_init(self);
}

EduUmassCsGnsclientClientCommandUtils *new_EduUmassCsGnsclientClientCommandUtils_init() {
  J2OBJC_NEW_IMPL(EduUmassCsGnsclientClientCommandUtils, init)
}

EduUmassCsGnsclientClientCommandUtils *create_EduUmassCsGnsclientClientCommandUtils_init() {
  J2OBJC_CREATE_IMPL(EduUmassCsGnsclientClientCommandUtils, init)
}

NSString *EduUmassCsGnsclientClientCommandUtils_specialCaseSingleFieldWithNSString_(NSString *response) {
  EduUmassCsGnsclientClientCommandUtils_initialize();
  if (EduUmassCsNioJSONPacket_couldBeJSONWithNSString_(response) && [((NSString *) nil_chk(response)) hasPrefix:@"{"]) {
    @try {
      OrgJsonJSONObject *json = create_OrgJsonJSONObject_initWithNSString_(response);
      IOSObjectArray *keys = EduUmassCsGnscommonUtilsCanonicalJSON_getNamesWithOrgJsonJSONObject_(json);
      return (((IOSObjectArray *) nil_chk(keys))->size_ == 1) ? [json getStringWithNSString:IOSObjectArray_Get(nil_chk(EduUmassCsGnscommonUtilsCanonicalJSON_getNamesWithOrgJsonJSONObject_(json)), 0)] : response;
    }
    @catch (OrgJsonJSONException *e) {
      [((OrgJsonJSONException *) nil_chk(e)) printStackTrace];
    }
  }
  return response;
}

OrgJsonJSONArray *EduUmassCsGnsclientClientCommandUtils_commandResponseToJSONArrayWithNSString_withNSString_(NSString *field, NSString *response) {
  EduUmassCsGnsclientClientCommandUtils_initialize();
  if (EduUmassCsNioJSONPacket_couldBeJSONArrayWithNSString_(response)) {
    return create_OrgJsonJSONArray_initWithNSString_(response);
  }
  else {
    return [create_OrgJsonJSONObject_initWithNSString_(response) getJSONArrayWithNSString:field];
  }
}

void EduUmassCsGnsclientClientCommandUtils_addMessageWithoutSignatureToJSONWithOrgJsonJSONObject_(OrgJsonJSONObject *command) {
  EduUmassCsGnsclientClientCommandUtils_initialize();
  if ([((OrgJsonJSONObject *) nil_chk(command)) hasWithNSString:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, SIGNATURE))) description]]) {
    NSString *signature = [command getStringWithNSString:[JreLoadEnum(EduUmassCsGnscommonGNSProtocol, SIGNATURE) description]];
    [command removeWithNSString:[JreLoadEnum(EduUmassCsGnscommonGNSProtocol, SIGNATURE) description]];
    NSString *commandSansSignature = EduUmassCsGnscommonUtilsCanonicalJSON_getCanonicalFormWithOrgJsonJSONObject_(command);
    [((OrgJsonJSONObject *) nil_chk([command putWithNSString:[JreLoadEnum(EduUmassCsGnscommonGNSProtocol, SIGNATURE) description] withId:signature])) putWithNSString:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, SIGNATUREFULLMESSAGE))) description] withId:commandSansSignature];
  }
}

EduUmassCsGnscommonPacketsResponsePacket *EduUmassCsGnsclientClientCommandUtils_checkResponseOldSchoolWithEduUmassCsGnscommonPacketsResponsePacket_(EduUmassCsGnscommonPacketsResponsePacket *cvrp) {
  EduUmassCsGnsclientClientCommandUtils_initialize();
  EduUmassCsGnsclientClientCommandUtils_checkResponseOldSchoolWithNSString_([((EduUmassCsGnscommonPacketsResponsePacket *) nil_chk(cvrp)) getReturnValue]);
  return cvrp;
}

NSString *EduUmassCsGnsclientClientCommandUtils_checkResponseOldSchoolWithNSString_(NSString *response) {
  EduUmassCsGnsclientClientCommandUtils_initialize();
  if ([((NSString *) nil_chk(response)) hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, BAD_RESPONSE))) description]]) {
    IOSObjectArray *results = [response java_split:@" "];
    if (((IOSObjectArray *) nil_chk(results))->size_ < 2) {
      @throw create_EduUmassCsGnscommonExceptionsClientClientException_initWithNSString_(JreStrcat("$$", @"Invalid bad response indicator: ", response));
    }
    else if (results->size_ >= 2) {
      NSString *error = IOSObjectArray_Get(results, 1);
      JavaLangStringBuilder *parts = create_JavaLangStringBuilder_init();
      for (jint i = 2; i < results->size_; i++) {
        [parts appendWithNSString:@" "];
        [parts appendWithNSString:IOSObjectArray_Get(results, i)];
      }
      NSString *rest = [parts description];
      if ([((NSString *) nil_chk(error)) hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, BAD_SIGNATURE))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientEncryptionException_initWithNSString_(error);
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, BAD_GUID))) description]] || [error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, BAD_ACCESSOR_GUID))) description]] || [error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, DUPLICATE_GUID))) description]] || [error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, BAD_ACCOUNT))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientInvalidGuidException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, DUPLICATE_FIELD))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientInvalidFieldException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, FIELD_NOT_FOUND))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientFieldNotFoundException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, ACCESS_DENIED))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientAclException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, DUPLICATE_NAME))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientDuplicateNameException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, VERIFICATION_ERROR))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientVerificationException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, ALREADY_VERIFIED_EXCEPTION))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientVerificationException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      if ([error hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, OPERATION_NOT_SUPPORTED))) description]]) {
        @throw create_EduUmassCsGnscommonExceptionsClientOperationNotSupportedException_initWithNSString_(JreStrcat("$$", error, rest));
      }
      @throw create_EduUmassCsGnscommonExceptionsClientClientException_initWithNSString_(JreStrcat("$$$", @"General command failure: ", error, rest));
    }
  }
  if ([response hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, NULL_RESPONSE))) description]]) {
    return nil;
  }
  else if ([response hasPrefix:[((NSString *) nil_chk([((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, ACTIVE_REPLICA_EXCEPTION))) description])) description]]) {
    @throw create_EduUmassCsGnscommonExceptionsClientInvalidGuidException_initWithNSString_(response);
  }
  else {
    return response;
  }
}

EduUmassCsGnscommonPacketsResponsePacket *EduUmassCsGnsclientClientCommandUtils_checkResponseWithEduUmassCsGnscommonPacketsResponsePacket_withEduUmassCsGnscommonPacketsCommandPacket_(EduUmassCsGnscommonPacketsResponsePacket *responsePacket, EduUmassCsGnscommonPacketsCommandPacket *command) {
  EduUmassCsGnsclientClientCommandUtils_initialize();
  EduUmassCsGnscommonResponseCode *code = [((EduUmassCsGnscommonPacketsResponsePacket *) nil_chk(responsePacket)) getErrorCode];
  NSString *returnValue = [responsePacket getReturnValue];
  if ([((EduUmassCsGnscommonResponseCode *) nil_chk(code)) isOKResult]) {
    return ([((NSString *) nil_chk(returnValue)) hasPrefix:[((EduUmassCsGnscommonGNSProtocol *) nil_chk(JreLoadEnum(EduUmassCsGnscommonGNSProtocol, NULL_RESPONSE))) description]]) ? nil : responsePacket;
  }
  NSString *errorSummary = JreStrcat("@$$$", code, @": ", returnValue, (command != nil ? JreStrcat("$@", @" for command ", [command getSummary]) : @""));
  switch ([code ordinal]) {
    case EduUmassCsGnscommonResponseCode_Enum_SIGNATURE_ERROR:
    @throw create_EduUmassCsGnscommonExceptionsClientEncryptionException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_BAD_GUID_ERROR:
    case EduUmassCsGnscommonResponseCode_Enum_BAD_ACCESSOR_ERROR:
    case EduUmassCsGnscommonResponseCode_Enum_BAD_ACCOUNT_ERROR:
    @throw create_EduUmassCsGnscommonExceptionsClientInvalidGuidException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_FIELD_NOT_FOUND_ERROR:
    @throw create_EduUmassCsGnscommonExceptionsClientFieldNotFoundException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_ACCESS_ERROR:
    @throw create_EduUmassCsGnscommonExceptionsClientAclException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_VERIFICATION_ERROR:
    @throw create_EduUmassCsGnscommonExceptionsClientVerificationException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_ALREADY_VERIFIED_EXCEPTION:
    @throw create_EduUmassCsGnscommonExceptionsClientVerificationException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_DUPLICATE_ID_EXCEPTION:
    @throw create_EduUmassCsGnscommonExceptionsClientDuplicateNameException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_DUPLICATE_FIELD_EXCEPTION:
    @throw create_EduUmassCsGnscommonExceptionsClientInvalidFieldException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_ACTIVE_REPLICA_EXCEPTION:
    @throw create_EduUmassCsGnscommonExceptionsClientInvalidGuidException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_NONEXISTENT_NAME_EXCEPTION:
    @throw create_EduUmassCsGnscommonExceptionsClientInvalidGuidException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    case EduUmassCsGnscommonResponseCode_Enum_TIMEOUT:
    case EduUmassCsGnscommonResponseCode_Enum_RECONFIGURATION_EXCEPTION:
    @throw create_EduUmassCsGnscommonExceptionsClientClientException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, errorSummary);
    default:
    @throw create_EduUmassCsGnscommonExceptionsClientClientException_initWithEduUmassCsGnscommonResponseCode_withNSString_(code, JreStrcat("$$", @"Error received with an unknown response code: ", errorSummary));
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(EduUmassCsGnsclientClientCommandUtils)
